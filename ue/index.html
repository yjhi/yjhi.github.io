<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>Editor</title><meta name="description" content="Editor Extended. Written by yjh."><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><script type="text/javascript" charset="utf-8" src="ueditor.config.js"></script><script type="text/javascript" charset="utf-8" src="ueditor.all.min.js"></script><script type="text/javascript" charset="utf-8" src="lang/zh-cn/zh-cn.js"></script><style type="text/css">body{margin:3px}.top{width:100%}.top h2{text-align:center}.btn{text-align:right;margin-bottom:2px}.btn button{border-width:0;background:#1e90ff;cursor:pointer;border-radius:3px;color:#fff;width:60px;height:30px}</style></head><body><div class="top"><h2 id="title"></h2><div class="btn"><button id="saveFile">保存</button> <button id="shareFile">分享</button></div></div><script id="editor" type="text/plain" style="width:98.5%;height:500px"></script><script src="../config/h.min.js"></script><script src="../layui/jquery.min.js"></script><script type="text/javascript">function getContent(){return UE.getEditor("editor").getContent()}function setContent(t){setTimeout(function(){UE.getEditor("editor").setContent(t)},300)}function hasContent(){return UE.getEditor("editor").hasContents()}function setFocus(){UE.getEditor("editor").focus()}function getLocalData(){var t=UE.getEditor("editor").execCommand("getlocaldata");return setContent(t),t}function clearLocalData(){UE.getEditor("editor").execCommand("clearlocaldata")}function saveFile(){if(null!=docId&&!isSaving&&isLoaded){var t=getContent();isSaving=!0;var e=baseUrl+"/api/md/edit?id="+docId;"1"==isGit&&(e=baseUrl+"/api/md/g/edit?id="+docId);var a={};a.gid=docId,a.content=t,$.ajax({url:e,type:"post",data:JSON.stringify(a),contentType:"application/json",success:function(t){isSaving=!1,0===t.code?(shareId=t.data,alert("保存成功")):alert(t.message)},error:function(t){isSaving=!1,alert("保存失败")}})}}var source=GetUrlParam("source"),isGit=GetUrlParam("g"),baseUrl=GetBaseUrl("a"==source?"a":"y"),docId="",shareId="",isLoaded=!1,isSaving=!1,ue=UE.getEditor("editor");$(function(){docId=GetUrlParam("id");var t=baseUrl+"/api/md/view?id="+docId;"1"==isGit&&(t=baseUrl+"/api/md/g/view?id="+docId),$.get(t,function(t,e){"success"==e?0===t.code?(document.title=t.data.title+"("+t.data.count+")",$("#title").text(t.data.title),setContent(t.data.content),isLoaded=!0):(isLoaded=!0,alert(t.message)):(isLoaded=!0,alert("获取内容失败,状态:"+e))}),$("#saveFile").click(function(){saveFile()}),$("#shareFile").click(function(){if(isLoaded)if(null!=shareId&&0<shareId.length){var t=GetRequestUrl()+"/ue/view/?source="+source+"&toc=1&id="+shareId+"&g=";"1"==isGit&&(t+="1"),window.open(t)}else alert("保存失败或没有保存,不能使用分享！")})})</script></body></html>