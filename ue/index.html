<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><title>Editor</title><meta name="description" content="Editor Extended. Written by yjh."><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><script type="text/javascript" charset="utf-8" src="ueditor.config.js"></script><script type="text/javascript" charset="utf-8" src="ueditor.all.min.js"></script><script type="text/javascript" charset="utf-8" src="lang/zh-cn/zh-cn.js"></script><style type="text/css">body{margin:3px}.top{width:100%}.top h2{text-align:center}.btn{text-align:right;margin-bottom:2px}.btn button{border-width:0;background:#1e90ff;cursor:pointer;border-radius:3px;color:#fff;width:60px;height:30px}</style></head><body><div class="top"><h2 id="title"></h2><div class="btn"><button id="saveFile">保存</button> <button id="shareFile">分享</button></div></div><script id="editor" type="text/plain" style="width:98.5%;height:500px"></script><script src="../config/h.min.js"></script><script src="../layui/jquery.min.js"></script><script type="text/javascript">function getContent(){return UE.getEditor("editor").getContent()}function setContent(e){setTimeout(function(){UE.getEditor("editor").setContent(e)},300)}function hasContent(){return UE.getEditor("editor").hasContents()}function setFocus(){UE.getEditor("editor").focus()}function getLocalData(){var e=UE.getEditor("editor").execCommand("getlocaldata");return setContent(e),e}function clearLocalData(){UE.getEditor("editor").execCommand("clearlocaldata")}function saveFile(){if(null!=docId&&!isSaving&&isLoaded){var e=getContent();isSaving=!0;var t=baseUrl+"/api/md/edit?id="+docId;"1"==isGit&&(t=baseUrl+"/api/md/g/edit?id="+docId);var i={};i.gid=docId,i.content=e,$.ajax({url:t,type:"post",data:JSON.stringify(i),contentType:"application/json",success:function(e){isSaving=!1,0===e.code?(shareId=e.data,alert("保存成功")):alert(e.message)},error:function(e){isSaving=!1,alert("保存失败")}})}}var source=GetUrlParam("source"),isGit=GetUrlParam("g"),baseUrl=GetBaseUrl(source);window.UEDITOR_CONFIG.serverUrl=baseUrl+"/api/ue/action",window.STATIC_URL=baseUrl;var docId="",shareId="",isLoaded=!1,isSaving=!1,ue=UE.getEditor("editor");$(function(){docId=GetUrlParam("id");var e=baseUrl+"/api/md/view?id="+docId;"1"==isGit&&(e=baseUrl+"/api/md/g/view?id="+docId),$.get(e,function(e,t){"success"==t?0===e.code?(document.title=e.data.title+"("+e.data.count+")",$("#title").text(e.data.title),setContent(e.data.content),isLoaded=!0):(isLoaded=!0,alert(e.message)):(isLoaded=!0,alert("获取内容失败,状态:"+t))}),$("#saveFile").click(function(){saveFile()}),$("#shareFile").click(function(){if(isLoaded)if(null!=shareId&&0<shareId.length){var e=GetRequestUrl()+"/ue/view/?source="+source+"&toc=1&id="+shareId+"&g=";"1"==isGit&&(e+="1"),window.open(e)}else alert("保存失败或没有保存,不能使用分享！")})})</script></body></html>