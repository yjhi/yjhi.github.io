<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><title>文档编辑</title><meta name="description" content="Markdown Extended Editer3. Written by yjh."><link rel="shortcut icon" href="favicon.ico"><link rel="stylesheet" href="css/style.css"><link rel="stylesheet" href="css/editormd.min.css"></head><body><div id="layout"><div id="editormd-view"></div></div><script src="../config/h.min.js"></script><script src="js/jquery.min.js"></script><script src="editormd.min.js"></script><script src="js/jquery.cookie.min.js"></script><script type="text/javascript">function SaveFile(){if(null!=docId&&isFirstLoad&&!isSaving){stringmd=editView.getMarkdown(),isSaving=!0;var e={};e.gid=docId,e.content=stringmd,$.ajax({url:baseUrl+"/api/md/g/edit",type:"post",data:JSON.stringify(e),contentType:"application/json",success:function(e){isSaving=!1,0===e.code?(shareId=e.data,alert("保存成功")):alert(e.message)},error:function(e){isSaving=!1,alert("保存失败")}})}}function initPasteImg(n){var e=document.getElementById(n.id);e.addEventListener("paste",function(e){var t=(e.clipboardData||window.clipboardData).items,a=null;if(t&&t.length){for(var i=0;i<t.length;i++)a=t[i].getAsFile();a&&uploadImg(a,n)}else alert("浏览器不支持粘贴图片！")});var t=document.getElementById(n.id);t.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()}),t.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()}),t.addEventListener("drop",function(e){e.preventDefault(),e.stopPropagation();var t=this.files||e.dataTransfer.files;uploadImg(t[0],n)})}function uploadImg(e,a){var t=new FormData,i=(new Date).getTime()+"."+e.name.split(".").pop();t.append("files",e,i),$.ajax({url:a.settings.imageUploadURL+"&date="+(new Date).toDateString(),type:"post",data:t,processData:!1,contentType:!1,dataType:"json",success:function(e){if(0===e.code){var t=e.data;/\.(png|jpg|jpeg|gif|bmp|ico)$/.test(t)?a.insertValue("![图片]("+t+' "图片")'):a.insertValue("[附件]("+t+")")}else alert(e.message)}})}function LoadData(){if(null!=docId){isFirstLoad=!0;var e=$.cookie("isReload");null!=e?"1"==e?(editView.setMarkdown($.cookie("markdown")),$.cookie("isReload","0")):$.get(baseUrl+"/api/md/g/view?id="+docId,function(e,t){"success"==t?0===e.code?(editView.setMarkdown(e.data.content),document.title=e.data.title+"("+e.data.count+")"):alert(e.message):alert("获取内容失败,状态:"+t)}):$.get(baseUrl+"/api/md/g/view?id="+docId,function(e,t){"success"==t?0===e.code?(editView.setMarkdown(e.data.content),document.title=e.data.title+"("+e.data.count+")"):alert(e.message):alert("获取内容失败,状态:"+t)})}}var editView,docId,source=GetUrlParam("source"),baseUrl=GetBaseUrl("a"==source?"a":"y"),shareId="",isFirstLoad=!1,isSaving=!1,cacheHtml="";$(function(){if(docId=GetUrlParam("id"),null!=docId){var e=document.compatMode&&"CSS1Compat"==document.compatMode?document.documentElement:document.body;editView=editormd("editormd-view",{width:"100%",height:e.clientHeight-15,path:"lib/",taskList:!0,tex:!0,flowChart:!0,sequenceDiagram:!0,codeFold:!0,disabledKeyMaps:["Ctrl-B","F11","F10"],toolbarIconsClass:{savefile:"fa-floppy-o",share:"fa-share-alt",print:"fa-print"},imageUpload:!0,imageFormats:["jpg","jpeg","gif","png","bmp","webp"],imageUploadURL:baseUrl+"/api/yq/upimg?type=markdown",editorTheme:"mdn-like",toolbarHandlers:{savefile:function(e,t,a,i){SaveFile()},share:function(e,t,a,i){null!=shareId&&0<shareId.length?window.open(baseUrl+"/md/gview.html?toc=1&id="+shareId):alert("保存失败或没有保存,不能使用分享！")},print:function(e,t,a,i){$.cookie("markdown",editView.getMarkdown()),$.cookie("isReload","1"),editView.previewing();var n=$(".editormd-preview").html();editView.previewed(),window.document.body.innerHTML=n,window.print(),window.location.reload()}},onchange:function(){$("#test").remove()},onload:function(){var e={"Ctrl-S":function(e){SaveFile()},"Ctrl-A":function(e){e.execCommand("selectAll")}};this.cm.on("keyup",function(e){});var t={"Ctrl-T":function(e){alert("Ctrl+T")}};this.addKeyMap(e),this.addKeyMap(t),this.removeKeyMap(t),LoadData(),initPasteImg(this)}})}else alert("文档不存在！")})</script></body></html>