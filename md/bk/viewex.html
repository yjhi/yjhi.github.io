<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <title>文档预览</title>
    <meta
      name="description"
      content="Markdown Viewer3.Written by yjh."
    />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/styleex.852369.css" />
    <link rel="stylesheet" href="css/editormd.preview.min.css" />
  </head>

  <body>
    <div id="layout">
      <div id="sidebar">
        <h1 class="toc-title">目录</h1>
        <h2 id="vcount" class="toc-count">1</h2>
        <div
          class="markdown-body editormd-preview-container"
          id="toc-container"
        ></div>
      </div>
      <div id="editormd-view"></div>
    </div>
    <script src="js/jquery.min.js"></script>
    <script src="lib/marked.min.js"></script>
    <script src="lib/prettify.min.js"></script>

    <script src="lib/raphael.min.js"></script>
    <script src="lib/underscore.min.js"></script>
    <script src="lib/sequence-diagram.min.js"></script>
    <script src="lib/flowchart.min.js"></script>
    <script src="lib/jquery.flowchart.min.js"></script>

    <script src="editormd.min.js"></script>
    <script type="text/javascript">
      function GetUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");

        var r = window.location.search.substr(1).match(reg);

        if (r != null) return unescape(r[2]);
        return null;
      }

      var baseUrl = window.location.protocol + "//" + window.location.host;

      var editormdView;
      var marktxt = "";

      $(function () {
        var gid = GetUrlParam("id");
        var toc = GetUrlParam("toc");

        $("#editormd-view").css("padding-right", 0);
        $("#sidebar").css("width", 0);
        $("#sidebar").hide();

        $("#vcount").text("");

        var url =
          baseUrl +
          "/api/md/view?id=" +
          gid +
          "&date=" +
          new Date().toDateString();

        if (gid != null) {
          $.get(url, function (data, status) {
            if (status == "success") {
              if (data.code === 0) {
                marktxt = data.data.content;

                $("#vcount").text(data.data.count);

                document.title =  data.data.title+"(" + data.data.count + ")";

                if (toc == "1") {
                  $("#editormd-view").css("padding-right", 350);
                  $("#sidebar").css("width", 350);
                  $("#sidebar").show();

                  editormdView = editormd.markdownToHTML("editormd-view", {
                    markdown: marktxt,
                    htmlDecode: "style,script,iframe",
                    markdownSourceCode: false,
                    tocContainer: "#toc-container",
                    tocDropdown: false,
                    taskList: true,
                    tex: true,
                    flowChart: true,
                    sequenceDiagram: true,
                    previewTheme: "mdn-like",
                  });
                } else {
                  editormdView = editormd.markdownToHTML("editormd-view", {
                    markdown: marktxt,
                    htmlDecode: "style,script,iframe",
                    markdownSourceCode: false,
                    taskList: true,
                    tex: true,
                    flowChart: true,
                    sequenceDiagram: true,
                    previewTheme: "mdn-like",
                  });
                }
              } else {
                alert(data.message);
              }
            } else {
              marktxt = "#### 加载数据失败";
              editormdView = editormd.markdownToHTML("editormd-view", {
                markdown: marktxt,
                htmlDecode: "style,script,iframe",
                markdownSourceCode: false,
                taskList: true,
                tex: true,
                flowChart: true,
                sequenceDiagram: true,
                previewTheme: "mdn-like",
              });
            }
          });
        } else {
          marktxt = "#### 加载失败,文档ID获取失败";

          editormdView = editormd.markdownToHTML("editormd-view", {
            markdown: marktxt,
            htmlDecode: "style,script,iframe",
            markdownSourceCode: false,
            taskList: true,
            tex: true,
            flowChart: true,
            sequenceDiagram: true,
            previewTheme: "mdn-like",
          });
        }
      });
    </script>
  </body>
</html>
